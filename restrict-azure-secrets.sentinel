import "tfconfig/v2" as tfconfig

# 1. Find all "azurerm" provider configurations
azurerm_providers = filter tfconfig.providers as address, provider {
    provider.name == "azurerm"
}

# 2. Violation Rule: Check if "client_secret" is defined in the config
# We want this to return TRUE (pass) if the secret is MISSING.
main = rule {
    all azurerm_providers as address, provider {
        not (keys(provider.config) contains "client_secret")
    }
}